Sub UpdateSheet3()
    ' Get the QG selection from cell
    Dim qgSelection As String
    qgSelection = ThisWorkbook.Sheets("Sheet1").Range("C14").value ' Assuming the drop-down list is in Sheet1
    
    ' ranges for each QG in Sheet2
    Dim qgc0Range As Range
    Dim qgc2Range As Range
    Dim qgc4Range As Range
    
    ' Ranges for each QG in Sheet3
    Dim targetRange As Range
    Set targetRange = ThisWorkbook.Sheets("Sheet3").Range("A2") ' Starting row to paste data
    
    ' ranges for each QG in Sheet2
    Select Case qgSelection
        Case "QGC0"
            Set qgc0Range = ThisWorkbook.Sheets("Sheet2").Range("A3:J3") ' Change the range accordingly
            'Set targetRange = targetRange.Resize(qgc0Range.Rows.Count, qgc0Range.Columns.Count)
            
            If CheckBox1.value = True Then
                ProcessQGC "QGC0", 1 ' Process Checkbox 1 for QGC0
            End If
            If CheckBox2.value = True Then
                ProcessQGC "QGC0", 2 ' Process Checkbox 2 for QGC0
            End If
            If CheckBox3.value = True Then
                ProcessQGC "QGC0", 3 ' Process Checkbox 3 for QGC0
            End If
            If CheckBox4.value = True Then
                ProcessQGC "QGC0", 4 ' Process Checkbox 4 for QGC0
            End If
            If CheckBox5.value = True Then
                ProcessQGC "QGC0", 5 ' Process Checkbox 5 for QGC0
            End If
            If CheckBox6.value = True Then
                ProcessQGC "QGC0", 6 ' Process Checkbox 6 for QGC0
            End If
            If CheckBox7.value = True Then
                ProcessQGC "QGC0", 7 ' Process Checkbox 7 for QGC0
            End If
            
        Case "QGC2"
            Set qgc2Range = ThisWorkbook.Sheets("Sheet2").Range("A20:J20") ' Change the range accordingly
            'Set targetRange = targetRange.Resize(qgc2Range.Rows.Count, qgc2Range.Columns.Count)
            
             If CheckBox1.value = True Then
                ProcessQGC "QGC2", 1 ' Process Checkbox 1 for QGC2
            End If
            If CheckBox2.value = True Then
                ProcessQGC "QGC2", 2 ' Process Checkbox 2 for QGC2
            End If
            If CheckBox3.value = True Then
                ProcessQGC "QGC2", 3 ' Process Checkbox 3 for QGC2
            End If
            
        Case "QGC4"
            Set qgc4Range = ThisWorkbook.Sheets("Sheet2").Range("A32:J32") ' Change the range accordingly
            'Set targetRange = targetRange.Resize(qgc4Range.Rows.Count, qgc4Range.Columns.Count)
            
            If CheckBox1.value = True Then
                ProcessQGC "QGC4", 1 ' Process Checkbox 1 for QGC4
            End If
            If CheckBox2.value = True Then
                ProcessQGC "QGC4", 2 ' Process Checkbox 2 for QGC4
            End If
            If CheckBox3.value = True Then
                ProcessQGC "QGC4", 3 ' Process Checkbox 3 for QGC4
            End If
            If CheckBox4.value = True Then
                ProcessQGC "QGC4", 4 ' Process Checkbox 4 for QGC4
            End If
            If CheckBox5.value = True Then
                ProcessQGC "QGC4", 5 ' Process Checkbox 5 for QGC4
            End If
            If CheckBox6.value = True Then
                ProcessQGC "QGC4", 6 ' Process Checkbox 6 for QGC4
            End If
            
        Case "Others"
            Exit Sub
    End Select
 'Copy data from selected range to target range
    If Not targetRange Is Nothing Then
        targetRange.value = GetRangeValues(qgSelection)
     Else
        'If target range is empty, display a msg
        MsgBox "The selected QGC range is empty.", vbExclamation
    End If
End Sub

 Function GetRangeValues(qgSelection As String) As Variant
    Dim sourceRange As Range
    Select Case qgSelection
        Case "QGC0"
            Set sourceRange = ThisWorkbook.Sheets("Sheet2").Range("A3:J17")
        Case "QGC2"
            Set sourceRange = ThisWorkbook.Sheets("Sheet2").Range("A20:J29")
        Case "QGC4"
            'Set sourceRange = ThisWorkbook.Sheets("Sheet2").Range("A32:J46")
        Case Else
            'Return empty array if selection is invalid
        GetRangeValues = Array()
        Exit Function
    End Select
     'Return values of source range as array
    GetRangeValues = sourceRange.value
End Function


Function ProcessQGC(ByVal qgcValue As String, ByVal checkboxNumber As Integer)
    Dim ws2 As Worksheet
    Dim ws3 As Worksheet
    Dim lastRow As Long
    Dim currentRow As Long
    Dim pasteRow As Long
    Dim sourceRange As Range
    Dim pasteRange As Range
    
    ' Assuming Sheet2 is where the data is stored and Sheet3 is where the processed data will be copied to
    Set ws2 = ThisWorkbook.Sheets("Sheet2")
    Set ws3 = ThisWorkbook.Sheets("Sheet3")
    
    ' Find the last row in Sheet2
    lastRow = ws2.Cells(ws2.Rows.Count, "A").End(xlUp).Row
    
    ' Initialize pasteRow
    pasteRow = 1
    
    ' Loop through each row in Sheet2
    For currentRow = 1 To lastRow
        ' Check if the current row matches the QGC value
        If ws2.Cells(currentRow, "A").value = qgcValue Then
            ' Check if the checkbox for the current row matches the checkboxNumber
            If ws2.Cells(currentRow, "C").Offset(0, checkboxNumber - 1).value = True Then
                ' Copy the row from Sheet2 and paste it into Sheet3
                Set sourceRange = ws2.Range("A" & currentRow & ":J" & currentRow)
                Set pasteRange = ws3.Range("A" & pasteRow)
                sourceRange.Copy pasteRange
                ' Increment pasteRow
                pasteRow = pasteRow + 1
            End If
        End If
    Next currentRow
End Function
