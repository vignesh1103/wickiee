Sub UpdateSheet3()
    ' Get the QG selection from cell
    Dim qgSelection As String
    qgSelection = ThisWorkbook.Sheets("Sheet1").Range("C14").Value ' Assuming the drop-down list is in Sheet1
    
    ' Define the target range in Sheet3
    Dim targetRange As Range
    Set targetRange = ThisWorkbook.Sheets("Sheet3").Range("A2") ' Starting row to paste data
    
    ' Define the source range in Sheet2 for each QGC
    Dim sourceRange As Range
    
    ' Checkboxes for QGC0
    Dim qgc0Checkboxes(1 To 7) As Boolean
    Dim i As Integer
    
    ' Checkboxes for QGC2
    Dim qgc2Checkboxes(1 To 3) As Boolean
    
    ' Checkboxes for QGC4
    Dim qgc4Checkboxes(1 To 6) As Boolean
    
    ' Populate checkbox arrays based on QG selection
    Select Case qgSelection
        Case "QGC0"
            For i = 1 To 7
                qgc0Checkboxes(i) = Me.Controls("CheckBox" & i).Value
            Next i
            Set sourceRange = ThisWorkbook.Sheets("Sheet2").Range("A3:J3") ' Range A3:J3 for QGC0
        Case "QGC2"
            For i = 1 To 3
                qgc2Checkboxes(i) = Me.Controls("CheckBox" & i).Value
            Next i
            Set sourceRange = ThisWorkbook.Sheets("Sheet2").Range("A20:J20") ' Range A20:J20 for QGC2
        Case "QGC4"
            For i = 1 To 6
                qgc4Checkboxes(i) = Me.Controls("CheckBox" & i).Value
            Next i
            Set sourceRange = ThisWorkbook.Sheets("Sheet2").Range("A32:J32") ' Range A32:J32 for QGC4
        Case Else
            ' Exit the subroutine if QGC selection is invalid
            Exit Sub
    End Select
    
    ' Check if source range is not empty
    If Not sourceRange Is Nothing Then
        ' Copy data from source range to target range
        targetRange.Resize(sourceRange.Rows.Count, sourceRange.Columns.Count).Value = sourceRange.Value
    Else
        ' Display a message if the source range is empty
        MsgBox "The selected QGC range is empty.", vbExclamation
    End If
    
    ' Process checkboxes based on QGC selection
    Select Case qgSelection
        Case "QGC0"
            For i = 1 To 7
                If qgc0Checkboxes(i) Then
                    ProcessQGC "QGC0", i ' Process Checkbox i for QGC0
                End If
            Next i
        Case "QGC2"
            For i = 1 To 3
                If qgc2Checkboxes(i) Then
                    ProcessQGC "QGC2", i ' Process Checkbox i for QGC2
                End If
            Next i
        Case "QGC4"
            For i = 1 To 6
                If qgc4Checkboxes(i) Then
                    ProcessQGC "QGC4", i ' Process Checkbox i for QGC4
                End If
            Next i
    End Select
End Sub

Function ProcessQGC(ByVal qgcValue As String, ByVal checkboxNumber As Integer)
    Dim ws2 As Worksheet
    Dim ws3 As Worksheet
    Dim lastRow As Long
    Dim currentRow As Long
    Dim pasteRow As Long
    Dim sourceRange As Range
    Dim pasteRange As Range
    
    ' Assuming Sheet2 is where the data is stored and Sheet3 is where the processed data will be copied to
    Set ws2 = ThisWorkbook.Sheets("Sheet2")
    Set ws3 = ThisWorkbook.Sheets("Sheet3")
    
    ' Find the last row in Sheet2
    lastRow = ws2.Cells(ws2.Rows.Count, "A").End(xlUp).Row
    
    ' Initialize pasteRow
    pasteRow = 1
    
    ' Loop through each row in Sheet2
    For currentRow = 1 To lastRow
        ' Check if the current row matches the QGC value
        If ws2.Cells(currentRow, "A").Value = qgcValue Then
            ' Check if the checkbox for the current row matches the checkboxNumber
            If ws2.Cells(currentRow, "C").Offset(0, checkboxNumber - 1).Value = True Then
                ' Copy the row from Sheet2 and paste it into Sheet3
                Set sourceRange = ws2.Range("A" & currentRow & ":J" & currentRow)
                Set pasteRange = ws3.Range("A" & pasteRow)
                sourceRange.Copy pasteRange
                ' Increment pasteRow
                pasteRow = pasteRow + 1
            End If
        End If
    Next currentRow
End Function
